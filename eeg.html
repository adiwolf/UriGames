<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×¡×™××•×œ×˜×•×¨ ×”×¨×¤×ª×§××ª ×‘×™×¦×ª ×”×©×•×§×•×œ×“</title>
    <!-- ×˜×¢×™× ×ª Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ×”×’×“×¨×ª ×¤×•× ×˜ Heebo ×œ×©×™×¤×•×¨ ×”× ×¨××•×ª ×‘×¢×‘×¨×™×ª */
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@400;700;900;bold&display=swap');
        body {
            font-family: 'Heebo', sans-serif;
            background-color: #f7fafc; /* ×¨×§×¢ ×‘×”×™×¨ */
        }
        /* ×× ×™××¦×™×™×ª ×§×¤×™×¦×” ×§×œ×” ×œ××™×™×§×•×Ÿ ×‘×¢×ª ×©×™× ×•×™ ×¡×¦× ×” */
        .bounce-animation {
            animation: bounce 0.5s ease-in-out;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0) scale(1.0); }
            50% { transform: translateY(-10px) scale(1.1); }
        }

        /* ×¡×’× ×•×Ÿ ×–×›×•×›×™×ª ×”××’×“×œ×ª ×•×”××›×•× ×” */
        #magnifier {
            /* ××¤×§×˜ ×”"×”×’×“×œ×”" ××• ×”×‘×”×™×¨×•×ª - × ×•×ª×Ÿ ×ª×—×•×©×” ×©××©×”×• × ×—×©×£ */
            box-shadow: 0 0 15px 5px rgba(255, 255, 255, 0.7);
            cursor: move;
            mix-blend-mode: overlay; /* ×™×•×¦×¨ ××¤×§×˜ ×‘×”×™×¨ ×™×•×ª×¨ ×¢×œ ×”×¨×§×¢ */
            transition: box-shadow 0.1s ease;
        }

        /* ×¡×’× ×•×Ÿ ×¨×›×™×‘×™ ×”××¢×’×œ ×”×—×©××œ×™ (× ×©××¨ ×œ×©××™×¨×ª ×¡×“×¨) */
        #circuit-grid svg {
            stroke-width: 15;
            stroke-linecap: round;
        }
        .code-input {
            width: 4rem; 
            height: 4rem; 
            text-align: center;
            font-size: 2rem;
            font-weight: 900;
            border-radius: 0.75rem;
            border: 2px solid #9ca3af;
        }
        
        .tile-element {
            /* ××‘×˜×™×— ×©×”-SVG ×™××œ× ××ª ×”×ª× ×•×©×”×œ×—×™×¦×” ×ª×¤×¢×œ */
            box-sizing: border-box; 
        }

        /* ×”×¢×‘×¨×ª ×¨×›×™×‘×™ ×”×§×œ×™×§ ×“×¨×š ×”×¨××– ×›×“×™ ×©×™×”×™×” × ×™×ª×Ÿ ×œ×’×¨×•×¨ ××¢×œ×™×• */
        #hidden-clue p {
            pointer-events: none;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="story-card" class="p-8 rounded-xl shadow-2xl transition-all duration-500 text-center mx-4 md:mx-auto max-w-lg w-full bg-gray-100">
        
        <h1 class="text-3xl font-extrabold mb-6 text-gray-800">×¡×™××•×œ×˜×•×¨ ×”×¨×¤×ª×§××ª ×‘×™×¦×ª ×”×©×•×§×•×œ×“</h1>
        
        <!-- ××™×™×§×•×Ÿ ×•×™×–×•××œ×™ ×”××™×™×¦×’ ××ª ×”×©×œ×‘ ×”× ×•×›×—×™ -->
        <div id="icon" class="text-6xl mb-6 transition-transform duration-500 transform scale-100">ğŸ¥š</div>
        
        <!-- ×˜×§×¡×˜ ×”×¡×™×¤×•×¨ ×”××©×ª× ×” -->
        <p id="story-text" class="text-xl mb-8 text-gray-700 leading-relaxed"></p>
        
        <!-- ××–×•×¨ ××©×—×§×™×•×ª ××™× ×˜×¨××§×˜×™×‘×™ -->
        <div id="game-controls-container" class="space-y-4">
            
            <!-- ×¡×˜×˜×•×¡ ××©×—×§ 1 (×™×œ×“) -->
            <div id="game-status-child" class="bg-gray-200 p-3 rounded-lg shadow-inner text-right text-base border border-gray-300 hidden">
                <p class="font-bold text-gray-700">×¡×™×›×•×™ × ×•×›×—×™ ×œ×¤×™×¦×•×™: <span id="chance-display" class="text-indigo-600 font-extrabold">40%</span></p>
                <p class="font-bold text-gray-700">× ×™×¡×™×•× ×•×ª ×©×›× ×•×¢ × ×•×ª×¨×•: <span id="attempts-display" class="text-red-500 font-extrabold">3</span></p>
            </div>

            <!-- ×›×¤×ª×•×¨×™ ×¤×¢×•×œ×” 1 (×™×œ×“) -->
            <div id="action-buttons-child" class="grid grid-cols-1 sm:grid-cols-2 gap-4 hidden">
                <button id="cry-button" class="action-btn bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-4 rounded-full shadow-lg transition-all duration-200 text-base">
                    ğŸ˜¢ ×‘×›×™ ×“×¨××˜×™ (+15% ××• -10%)
                </button>
                <button id="logic-button" class="action-btn bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-4 rounded-full shadow-lg transition-all duration-200 text-base">
                    ğŸ§ ×”×¦×’×ª ×”×•×›×—×•×ª (+10% ×‘×˜×•×—)
                </button>
            </div>
            
            <!-- **××©×—×§ 3: ×¤×ª×™×—×ª ×”×‘×™×¦×™× (×××¦×¢×™)** -->
            <div id="egg-opening-game" class="hidden grid grid-cols-5 gap-2 justify-items-center p-4">
                <!-- ×”×‘×™×¦×™× ×™×˜×¢× ×• ×›××Ÿ ×‘×××¦×¢×•×ª JavaScript -->
            </div>

            <!-- **××©×—×§ 6: × ×™×ª×•×— ×™×•×× ×™× (××‘×)** -->
            <div id="log-analysis-game" class="hidden flex flex-col items-center space-y-4 p-4 bg-gray-900 rounded-xl shadow-inner w-full">
                <p class="text-base text-white font-semibold text-center">
                    ×œ×—×¥ ×¢×œ ×”×¢××•×“×” (×—×™×™×©×Ÿ) ×©×‘×” ××ª×” ××–×”×” ××ª ×”× ×ª×•×Ÿ ×”×—×¨×™×’ ×‘×™×•×ª×¨.
                </p>
                <div id="log-grid" class="grid gap-2 p-2 bg-gray-700 rounded-md mx-auto">
                    <!-- Log tiles here -->
                </div>
            </div>

            <!-- **××©×—×§ 4: ×ª×›× ×•×Ÿ ×”×—×§×™×¨×” (××‘×)** -->
            <div id="planning-game" class="hidden space-y-3">
                <!-- ×¨××–×™× ××™×œ×•×œ×™×™× ×‘×ª×•×š ×”×›×¤×ª×•×¨×™× ×•×”×¡×¨×ª ×”×¦×‘×¢ ×”×¦×”×•×‘ ××”×ª×©×•×‘×” ×”× ×›×•× ×” -->
                <button id="plan-vats" class="plan-btn w-full bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-4 rounded-full shadow-md transition-all duration-200 text-base">
                    1. ××™×›×œ×™ ×”×¢×¨×‘×•×‘ (×©×œ×‘ ×™×¦×™×¨×ª ×”×©×•×§×•×œ×“)
                </button>
                <button id="plan-insertion" class="plan-btn w-full bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-4 rounded-full shadow-md transition-all duration-200 text-base">
                    2. ×–×¨×•×¢ ×”×–×¨×§×ª ×”×¦×¢×¦×•×¢ (×”×× ×–×” ×§×©×•×¨ ×œ×¦×¢×¦×•×¢?)
                </button>
                <button id="plan-weight" class="plan-btn w-full bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-4 rounded-full shadow-md transition-all duration-200 text-base">
                    3. ×ª× ×‘×“×™×§×ª ×”××©×§×œ (×‘×•×“×§ ××©×§×œ ×¡×•×¤×™)
                </button>
            </div>


            <!-- ×›×¤×ª×•×¨×™ ×¤×¢×•×œ×” 2 (××‘× - ×—×§×™×¨×”) - × ×¡×ª×¨×™× ×œ×—×œ×•×˜×™×Ÿ -->
            <div id="action-buttons-father" class="hidden"></div>
            
            <!-- **××–×•×¨ ×”×—×§×™×¨×” ×”××™× ×˜×¨××§×˜×™×‘×™ (××‘×)** -->
            <div id="investigation-area" class="hidden flex flex-col items-center p-4 bg-gray-900 rounded-xl shadow-xl border-4 border-gray-700 w-full">
                <p class="text-sm font-semibold mb-2 text-white text-right">×”×–×– ××ª ×–×›×•×›×™×ª ×”××’×“×œ×ª ×›×“×™ ×œ××¦×•× ××ª ×”×—×™×™×©×Ÿ ×”×ª×§×•×œ ×‘××›×•× ×”!</p>
                <div id="machine-visual" class="relative w-full h-64 bg-gray-800 rounded-md cursor-move border-dashed border-2 border-red-500/50">
                    
                    <!-- ×¨×›×™×‘×™× ×•×™×–×•××œ×™×™× ×œ×”×¡×•×•××” (× ×¨××™× ×›××• ×—×œ×§×™× ×¤× ×™××™×™× ×©×œ ×”××›×•× ×”) -->
                    <div class="absolute top-10 left-10 w-20 h-4 bg-gray-600 rounded"></div>
                    <div class="absolute top-20 right-5 w-16 h-8 bg-yellow-400 rounded"></div>
                    <div class="absolute bottom-5 left-1/4 w-1/2 h-10 bg-gray-700 rounded"></div>
                    
                    <!-- ×¨×›×™×‘×™× × ×•×¡×¤×™× ×œ×”×¡×•×•××” -->
                    <div class="absolute top-20 left-20 w-12 h-12 bg-gray-700 rounded-full border-2 border-red-500/50"></div>
                    <div class="absolute bottom-10 right-10 w-16 h-4 bg-gray-600 rounded"></div>

                    <!-- ××™×§×•× ×”×‘×¢×™×”: ×–×” ×”××™×§×•× ×©×œ ×”×‘×¢×™×” (0.65, 0.30). × ×©××™×¨ ××•×ª×• ×¨×™×§ ××• × ×•×¡×™×£ ××©×”×• ×§×˜×Ÿ ×•×œ× ×‘×¨×•×¨. -->
                    <div class="absolute" style="top: 30%; left: 65%;">
                         <div class="w-2 h-2 rounded-full bg-yellow-200/50 ring-2 ring-yellow-300"></div>
                    </div>


                    <!-- ×–×›×•×›×™×ª ×”××’×“×œ×ª - ×ª×–×•×– ×¢× JS -->
                    <div id="magnifier" class="absolute w-24 h-24 rounded-full border-4 border-white bg-white/20" style="top: 0; left: 0;">
                    </div>
                </div>
                <button id="give-up-button" class="mt-4 bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-full shadow-md transition-all duration-200 text-base">
                    ğŸ˜« ×”××‘× ××•×•×ª×¨ (×›×™×©×œ×•×Ÿ)
                </button>
            </div>


            <!-- ×›×¤×ª×•×¨ ×œ×”×ª×§×“××•×ª ×‘×¡×™×¤×•×¨ (××• ×”×¤× ×™×” ××—×¨×•× ×”) -->
            <button id="next-button" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105 active:scale-95 w-full text-lg"></button>
        </div>
        
        <!-- ×”×•×“×¢×ª ××©×•×‘ ×¢×œ ×”×¦×œ×—×”/×›×™×©×œ×•×Ÿ -->
        <p id="feedback-message" class="mt-4 text-sm font-semibold text-transparent"></p>
    </div>

    <script>
        // --- ××©×ª× ×™ ××©×—×§ ×’×œ×•×‘×œ×™×™× ---
        let currentScene = 0; // ××¢×§×‘ ××—×¨ ×”×¡×¦× ×” ×”× ×•×›×—×™×ª
        let attemptsLeft = 3; // ××¡×¤×¨ × ×™×¡×™×•× ×•×ª ×©×›× ×•×¢ ×©× ×•×ª×¨×• ×‘××¤×¢×œ (××©×—×§ 1)
        let currentSuccessChance = 0.40; // ×¡×™×›×•×™ ×”×ª×—×œ×ª×™ ×œ× ×™×¦×—×•×Ÿ (40%) (××©×—×§ 1)
        const MAX_CHANCE = 0.95; // ×¡×™×›×•×™ ××§×¡×™××œ×™ ×©× ×™×ª×Ÿ ×œ×”×’×™×¢ ××œ×™×•

        // --- ××©×ª× ×™ ××©×—×§ 2 (××‘× - ×’×¨×™×¨×”) ---
        let isDragging = false;
        let magnifier = null;
        let machineVisual = null;
        let checkInterval = null;
        
        // **×”×’×“×¨×•×ª ×§×•×©×™ ××©×—×§ 2 (×’×¨×™×¨×”):**
        const SOLUTION_TOLERANCE_PX = 25; // ×¨×“×™×•×¡ ×§×˜×Ÿ ×™×•×ª×¨ (25 ×¤×™×§×¡×œ×™×) ×“×•×¨×© ×“×™×•×§ ×’×‘×•×” ×××•×“
        const SUCCESS_HOLD_TIME_MS = 2000; // ×–××Ÿ ×”×—×–×§×” ××¨×•×š ×™×•×ª×¨ (2 ×©× ×™×•×ª) ×“×•×¨×© ×™×¦×™×‘×•×ª
        
        // **××™×§×•× ×”×¤×ª×¨×•×Ÿ ×”× ×¡×ª×¨** (××—×•×–×™× ×™×—×¡×™×™× ×‘××›×•× ×”)
        const SOLUTION_X_RATIO = 0.65; // 65% ××”×¨×•×—×‘
        const SOLUTION_Y_RATIO = 0.30; // 30% ××”×’×•×‘×”
        
        let holdStartTime = null; // ×”×–××Ÿ ×©×‘×• ×”×—×œ ×”×©×—×§×Ÿ ×œ×”×—×–×™×§ ××¢×œ ×”×¤×ª×¨×•×Ÿ

        // --- ××©×ª× ×™ ××©×—×§ 3 (×¡×¢×•×“×”) ---
        let emptyEggFound = false;
        let eggsToOpen = 5;
        let EMPTY_EGG_INDEX = -1; 
        
        // --- ××©×ª× ×™ ××©×—×§ 6 (× ×™×ª×•×— ×™×•×× ×™×) - NEW ---
        const LOG_GRID_SIZE = 5; // *×”×’×“×œ×ª×™ ××ª ×”×’×•×“×œ ×œ-5x5*
        let faultyColumn = -1;
        let logDataGrid = [];


        // ×”×’×“×¨×ª ××¢×¨×š ×©×œ ×©×œ×‘×™× (×¡×¦× ×•×ª) ×‘×¡×™×¤×•×¨
        const scenes = [
            // 0: ×”×ª×—×œ×”
            { text: "×”×™×™! ×§×™×‘×œ×ª **×‘×™×¦×ª ×”×¤×ª×¢×”** ×—×“×©×”! ×”×™× ×’×“×•×œ×”, ××‘×¨×™×§×” ×•××‘×˜×™×—×” ×”×¤×ª×¢×” × ×”×“×¨×ª ×‘×¤× ×™×.", button: "×¤×ª×— ××ª ×”×‘×™×¦×”", color: "bg-yellow-100", icon: "ğŸ¥š" },
            // 1: ×’×™×œ×•×™ ×”××›×–×‘×”
            { text: "×¨×’×¢... ×¤×ª×—×ª ××ª ×”×‘×™×¦×” ×•×’×™×œ×™×ª ×©×”×™× **×¨×™×§×”**! ××™×Ÿ ×‘×¤× ×™× ×œ× ×©×•×§×•×œ×“ ×•×œ× ×¦×¢×¦×•×¢. ××™×–×• **××›×–×‘×” × ×•×¨××™×ª**!", button: "×¤× ×” ×œ××¤×¢×œ ×‘×‘×§×©×ª ×¤×™×¦×•×™", color: "bg-red-200", icon: "ğŸ˜­" },
            // 2: ×”×’×¢×” ×œ××¤×¢×œ (×©×œ×‘ ××©×—×§×™ ××™× ×˜×¨××§×˜×™×‘×™ - ×™×œ×“)
            { text: "××ª×” ×‘××¤×¢×œ! ×”×× ×”×œ × ×¨××” ×¢×¡×•×§. ×¢×œ×™×š **×œ×”×’×“×™×œ ××ª ×”×¡×™×›×•×™ ×©×œ×š** ×œ×¤×™×¦×•×™ ×”××œ× ×‘×××¦×¢×•×ª ×©×›× ×•×¢ ××™× ×˜× ×¡×™×‘×™. ×™×© ×œ×š 3 × ×™×¡×™×•× ×•×ª!", button: "×¢×‘×•×¨ ×œ×”×¤× ×™×” ××—×¨×•× ×”", color: "bg-blue-100", icon: "ğŸ­" , isGameChild: true },
            // 3: ×”×¦×œ×—×” ×‘×©×™×›× ×•×¢ (×¤×™×¦×•×™ ××œ× - ×¡×•×£ ×¤×¨×§ 1)
            { text: "×”×× ×”×œ ××–×“×¢×–×¢! ×”×•× ××ª× ×¦×œ... **×–×›×™×ª ×‘×¤×™×¦×•×™ ×”××œ×!** 5 ×‘×™×¦×™× ×—×“×©×•×ª, ×××¨×– ×©×•×§×•×œ×“ ×¢× ×§ ×•×›×¨×˜×™×¡ ×œ×¤××¨×§.", button: "×œ×š ×”×‘×™×ª×” ×œ×—×’×•×’ ×¢× ×”××©×¤×—×”", color: "bg-green-200", icon: "ğŸ¥³" },
            // 4: ×›×™×©×œ×•×Ÿ ×‘×©×™×›× ×•×¢ (×¤×™×¦×•×™ ××¢×œ×™×‘ - ×œ×•×œ××”)
            { text: "×”×× ×”×œ ××’×œ×’×œ ×¢×™× ×™×™× ×•××•××¨: '×‘×¡×“×¨ ×™×œ×“, ×§×— **×‘×™×¦×” ×‘×•×“×“×ª ××—×ª** ×›×“×™ ×©×ª×©×ª×•×§.' (×¤×™×¦×•×™ ×—×œ×§×™ ×•××¢×œ×™×‘! ×”×× ×ª×•×•×ª×¨?)", button: "×œ× ××•×•×ª×¨! × ×¡×” ×œ×©×›× ×¢ ×©×•×‘!", color: "bg-orange-200", icon: "ğŸ˜¤" },
            // 5: ×¡×¢×•×“×ª ×”×¤×™×¦×•×™ (××©×—×§ ×¤×ª×™×—×ª ×‘×™×¦×™×)
            { text: "×—×–×¨×ª× ×”×‘×™×ª×” ×¢× ×”×©×œ×œ! ×”××©×¤×—×” ××ª×›× ×¡×ª ×œ×¤×ª×•×— ××ª 5 ×‘×™×¦×™ ×”×¤×™×¦×•×™ ×”×¢× ×§×™×•×ª. ×‘×•××• × ×¤×ª×— ××•×ª×Ÿ ××—×ª-××—×ª...", button: "×”××©×š ×œ×¤×ª×™×—×ª ×”×‘×™×¦×™×", color: "bg-green-100", icon: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦" , isGameFeast: true},
            // 6: NEW - × ×™×ª×•×— ×™×•×× ×™ ×™×™×¦×•×¨ (××‘× - ××ª×’×¨ ×× ×œ×™×˜×™, ×”×—×œ×™×£ ××ª ×”××¢×’×œ ×”×—×©××œ×™)
            { text: "×”××‘× ××•×¨×©×” ×œ×”×™×›× ×¡ ×œ×—×“×¨ ×‘×§×¨×ª ×”××™×›×•×ª ×•×œ×‘×—×•×Ÿ ××ª **×™×•×× ×™ ×”×™×™×¦×•×¨** ×”××—×¨×•× ×™×. ×¢×œ×™×• ×œ××ª×¨ ×‘××”×™×¨×•×ª ××™×–×” **×—×™×™×©×Ÿ ××©×§×œ** ××¦×™×’ × ×ª×•× ×™× ×—×¨×™×’×™×.", button: "", color: "bg-blue-300", icon: "ğŸ“Š", isGameLogAnalysis: true },
            // 7: ×ª×›× ×•×Ÿ ×”×—×§×™×¨×” (××©×—×§ ×‘×—×™×¨×ª ××–×•×¨)
            { text: "×”××‘× ×§×™×‘×œ ××¤×” ×©×œ ×”××¤×¢×œ. ××›×™×•×•×Ÿ ×©×”×‘×™×¦×” ×”×™×™×ª×” **×¨×™×§×” ×œ×’××¨×™** (×—×¡×¨ ×‘×” ×©×•×§×•×œ×“), ×¢×œ×™×• ×œ×‘×—×•×¨ ××ª ×”××–×•×¨ **×”×”×’×™×•× ×™ ×‘×™×•×ª×¨** ×œ×”×ª×—×™×œ ××ª ×”×—×§×™×¨×”. ××™×–×” ×©×œ×‘ ×‘××¤×¢×œ ××—×¨××™ ×œ××™×ª×•×¨ ××•×¦×¨ ×—×¡×¨?", button: "", color: "bg-orange-300", icon: "ğŸ—ºï¸", isGamePlanning: true },
            // 8: ×”××‘× ××’×™×¢ ×œ××¤×¢×œ (×©×œ×‘ ×—×§×™×¨×” - ××©×—×§ ×’×¨×™×¨×”)
            { text: "×”×’×¢×ª× ×œ××–×•×¨ **×ª× ×‘×“×™×§×ª ×”××©×§×œ**! ×”××§×•× × ×¨××” ×¢××•×¡. ×¢×œ×™×š **×œ×”×–×™×– ××ª ×–×›×•×›×™×ª ×”××’×“×œ×ª** ××¢×œ ×”××›×•× ×” ×›×“×™ ×œ××¦×•× ××ª ×”×—×œ×§ ×”×ª×§×•×œ. ×”×‘×¢×™×” ×œ× ×‘×¨×•×¨×”! (×“×¨×•×©×•×ª 2 ×©× ×™×•×ª ×©×œ ×™×¦×™×‘×•×ª)", button: "", color: "bg-gray-500", icon: "ğŸ•µï¸" , isGameFather: true},
            // 9: ×”×¦×œ×—×” - ×”××‘× ××§×‘×œ ×¢×‘×•×“×”
            { text: "××¦××ª ××ª ×”×‘×¢×™×”! ×”×—×™×™×©×Ÿ ×‘×ª× ×‘×“×™×§×ª ×”××©×§×œ ×”×™×” ×ª×§×•×œ. ×”×× ×”×œ, × ×“×”× ××”××§×¦×•×¢×™×•×ª ×©×œ×š, ××¦×™×¢ ×œ×š ××©×¨×” ××œ××” ×›×× ×”×œ ×‘×§×¨×ª ××™×›×•×ª! **×”××‘× ××§×‘×œ ×¢×‘×•×“×”!**", button: "×”×ª×—×œ ×¡×™×¤×•×¨ ×—×“×©", color: "bg-purple-300", icon: "ğŸ’¼" },
            // 10: ×›×™×©×œ×•×Ÿ - ×”××‘× ×××‘×“ ×ª×§×•×•×”
            { text: "×—×™×¤×©×ª ×©×¢×•×ª ×‘××›×•× ×” ×”×œ× × ×›×•× ×”, ××š ×œ× ××¦××ª ×›×œ×•×. ×”×× ×”×œ ×›×•×¢×¡ ×•×§×•×¨× ×œ×××‘×˜×—. ×—×–×¨×ª ×”×‘×™×ª×” ×××•×›×–×‘. **×”××©×¤×—×” ×¢×“×™×™×Ÿ ×¨×¢×‘×”.**", button: "×”×ª×—×œ ×¡×™×¤×•×¨ ×—×“×©", color: "bg-black-700 text-white", icon: "ğŸ˜¢" }
        ];

        // --- ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ - ××©×—×§ 1 (×™×œ×“) ---

        /** ××¢×“×›×Ÿ ××ª ×ª×¦×•×’×ª ×”×¡×™×›×•×™×™× ×•×”× ×™×¡×™×•× ×•×ª ×”× ×•×ª×¨×™× */
        function updateStatusDisplay() {
            document.getElementById('chance-display').textContent = `${Math.round(currentSuccessChance * 100)}%`;
            document.getElementById('attempts-display').textContent = attemptsLeft;
            
            // ×¢×“×›×•×Ÿ ×›×¤×ª×•×¨ ×”×¤× ×™×” ××—×¨×•× ×” ×‘×”×ª×× ×œ× ×™×¡×™×•× ×•×ª ×©× ×•×ª×¨×•
            const nextButton = document.getElementById('next-button');
            if (attemptsLeft === 0) {
                 nextButton.textContent = '×œ×—×¥ ×›××Ÿ ×œ×ª×•×¦××” (××™×Ÿ ×™×•×ª×¨ × ×™×¡×™×•× ×•×ª)';
            } else {
                 nextButton.textContent = `×¢×‘×•×¨ ×œ×”×¤× ×™×” ××—×¨×•× ×” (× ×•×ª×¨×• ${attemptsLeft} × ×™×¡×™×•× ×•×ª)`;
            }
        }

        /** ××—×©×‘ ××ª ×”×¡×™×›×•×™ ×œ× ×™×¦×—×•×Ÿ ×”×¡×•×¤×™ ×•××¢×“×›×Ÿ ××ª ×”×¡×¦× ×” */
        function handleFinalPlea() {
            if (currentScene !== 2) return;
            
            const feedbackElement = document.getElementById('feedback-message');
            const roll = Math.random(); 

            // ×”×¡×ª×¨×ª ×›×¤×ª×•×¨×™ ×”×¤×¢×•×œ×” ×•×”×¡×˜×˜×•×¡ ×‘×–××Ÿ ×”×‘×“×™×§×”
            document.getElementById('action-buttons-child').classList.add('hidden');
            document.getElementById('game-status-child').classList.add('hidden');

            feedbackElement.textContent = '';
            feedbackElement.classList.remove('text-green-700', 'text-red-700');
            
            // ×”×©×”×™×™×” ×§×¦×¨×” ×œ×¤× ×™ ×ª×•×¦××” ×›×“×™ ×œ×™×¦×•×¨ ××ª×—
            setTimeout(() => {
                if (roll < currentSuccessChance) {
                    // ×”×¦×œ×—×” (××¢×‘×¨ ×œ×¡×¦× ×” 3, ×”×¤×™×¦×•×™ ×”××œ×)
                    feedbackElement.textContent = `×”×¦×œ×—×” ××“×”×™××”! ×”×¡×™×›×•×™ ×©×œ×š (${Math.round(currentSuccessChance * 100)}%) ×”×•×‘×™×œ ×œ× ×™×¦×—×•×Ÿ!`;
                    feedbackElement.classList.add('text-green-700');
                    currentScene = 3; 
                } else {
                    // ×›×™×©×œ×•×Ÿ (××¢×‘×¨ ×œ×¡×¦× ×” 4, ×¤×™×¦×•×™ ××¢×œ×™×‘)
                    feedbackElement.textContent = `×”×× ×”×œ ×§××¦×Ÿ! ×”×¡×™×›×•×™ ×©×œ×š (${Math.round(currentSuccessChance * 100)}%) ×œ× ×”×¡×¤×™×§.`;
                    feedbackElement.classList.add('text-red-700');
                    currentScene = 4; 
                }
                
                // ×¢×“×›×•×Ÿ ×”×ª×¦×•×’×” ×œ××—×¨ ×§×‘×™×¢×ª ×”×ª×•×¦××”
                updateScene();
            }, 750);
        }

        /** ×œ×•×’×™×§×” ×œ×¤×¢×•×œ×ª "×‘×›×™ ×“×¨××˜×™" */
        function handleCry() {
            if (attemptsLeft <= 0) return;
            attemptsLeft--;
            const feedbackElement = document.getElementById('feedback-message');
            feedbackElement.classList.remove('text-green-700', 'text-red-700');
            
            const cryRoll = Math.random();
            if (cryRoll < 0.7) { // 70% ×¡×™×›×•×™ ×œ×”×¦×œ×—×”
                currentSuccessChance = Math.min(MAX_CHANCE, currentSuccessChance + 0.15); // +15%
                feedbackElement.textContent = `ğŸ˜¢ ×”×‘×›×™ ×©×œ×š × ×’×¢ ×œ×œ×™×‘×•! (+15% ×¡×™×›×•×™)`;
                feedbackElement.classList.add('text-green-700');
            } else {
                currentSuccessChance = Math.max(0.1, currentSuccessChance - 0.10); // -10% (××™× ×™××•× ×¡×™×›×•×™ 10%)
                feedbackElement.textContent = `ğŸ˜  ×”×× ×”×œ ×—×©×‘ ×©××ª×” ××–×•×™×£ ×•×”×ª×¢×¦×‘×Ÿ! (-10% ×¡×™×›×•×™)`;
                feedbackElement.classList.add('text-red-700');
            }
            updateStatusDisplay();
        }

        /** ×œ×•×’×™×§×” ×œ×¤×¢×•×œ×ª "×”×¦×’×ª ×”×•×›×—×•×ª" */
        function handleLogic() {
            if (attemptsLeft <= 0) return;
            attemptsLeft--;
            const feedbackElement = document.getElementById('feedback-message');
            feedbackElement.classList.remove('text-green-700', 'text-red-700');

            currentSuccessChance = Math.min(MAX_CHANCE, currentSuccessChance + 0.10); // +10% ×‘×˜×•×—
            feedbackElement.textContent = `ğŸ§ ×”×¦×’×ª ××ª ×”×‘×™×¦×” ×”×¨×™×§×” ×‘×‘×”×™×¨×•×ª. ×”×”×™×’×™×•×Ÿ ×¢×•×‘×“! (+10% ×¡×™×›×•×™)`;
            feedbackElement.classList.add('text-green-700');
            updateStatusDisplay();
        }
        
        // --- ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ - ××©×—×§ 2 (××‘× - ×’×¨×™×¨×”) ---

        // ×§×‘×œ×ª ×§×•××•×¨×“×™× ×˜×•×ª ××ª××™××•×ª ×œ×¢×›×‘×¨ ××• ×œ×˜××¦'
        function getClientCoords(event) {
            if (event.touches) {
                return { x: event.touches[0].clientX, y: event.touches[0].clientY };
            }
            return { x: event.clientX, y: event.clientY };
        }

        // ×”×ª×—×œ×ª ×’×¨×™×¨×”
        function startDrag(event) {
            isDragging = true;
            if (event.type === 'touchstart') {
                event.preventDefault(); // ××•× ×¢ ×’×œ×™×œ×” ×‘×˜××¦'
            }
        }

        // ×¡×™×•× ×’×¨×™×¨×”
        function endDrag() {
            isDragging = false;
        }

        // ×¤×¢×•×œ×ª ×’×¨×™×¨×”
        function drag(event) {
            if (!isDragging || currentScene !== 8 || !magnifier) return; // Note: currentScene is now 8

            const coords = getClientCoords(event);
            const machineRect = machineVisual.getBoundingClientRect();
            const magnifierSize = magnifier.offsetWidth;
            const halfSize = magnifierSize / 2;

            // ×—×™×©×•×‘ ××™×§×•× ×™×—×¡×™ ×‘×ª×•×š ×”××›×•× ×”
            let x = coords.x - machineRect.left - halfSize;
            let y = coords.y - machineRect.top - halfSize;

            // ×©××™×¨×” ×¢×œ ×’×‘×•×œ×•×ª ×”××›×•× ×”
            x = Math.max(0, Math.min(x, machineRect.width - magnifierSize));
            y = Math.max(0, Math.min(y, machineRect.height - magnifierSize));

            magnifier.style.left = `${x}px`;
            magnifier.style.top = `${y}px`;
        }

        // ×‘×“×™×§×” ×—×•×–×¨×ª ×•× ×©× ×™×ª ×”×× ×–×›×•×›×™×ª ×”××’×“×œ×ª × ××¦××ª ××¢×œ ×”×¤×ª×¨×•×Ÿ
        function checkForSolution() {
            if (currentScene !== 8 || !magnifier) return; // Note: currentScene is now 8

            const machineRect = machineVisual.getBoundingClientRect();
            const magnifierRect = magnifier.getBoundingClientRect();
            const feedbackElement = document.getElementById('feedback-message');
            
            // ××¨×›×– ×”××’×“×œ×ª
            const magCenterX = magnifierRect.left + magnifierRect.width / 2;
            const magCenterY = magnifierRect.top + magnifierRect.height / 2;
            
            // **××™×§×•× ×”×¤×ª×¨×•×Ÿ ×”× ×¡×ª×¨ (×—×™×™×©×Ÿ ×”××©×§×œ) - ××—×•×©×‘ ×œ×¤×™ ×™×—×¡ ×§×‘×•×¢**
            const solutionCenterX = machineRect.left + machineRect.width * SOLUTION_X_RATIO;
            const solutionCenterY = machineRect.top + machineRect.height * SOLUTION_Y_RATIO;

            // ×—×™×©×•×‘ ××¨×—×§ ×‘×™×Ÿ ×”××¨×›×–×™×
            const distance = Math.sqrt(
                Math.pow(magCenterX - solutionCenterX, 2) + 
                Math.pow(magCenterY - solutionCenterY, 2)
            );

            // ×× ×”××¨×—×§ ×§×˜×Ÿ ××¡×£ ×”×¡×‘×™×œ×•×ª - ×”××’×“×œ×ª ××¢×œ ×”×¤×ª×¨×•×Ÿ
            if (distance < SOLUTION_TOLERANCE_PX) {
                if (holdStartTime === null) {
                    // ×”×ª×—×œ ×¡×¤×™×¨×” ×œ××—×•×¨
                    holdStartTime = Date.now();
                    feedbackElement.textContent = `× ×¨××” ×©××¦××ª ××©×”×•! ×”×—×–×§ ××ª ×”××’×“×œ×ª ×‘××§×•×...`;
                    feedbackElement.classList.remove('text-transparent', 'text-red-500', 'text-green-500');
                    feedbackElement.classList.add('text-yellow-400', 'font-extrabold');

                } else {
                    const heldDuration = Date.now() - holdStartTime;
                    const remainingTime = SUCCESS_HOLD_TIME_MS - heldDuration;
                    
                    // ×¢×“×›×•×Ÿ ×”×ª×§×“××•×ª ×•×™×–×•××œ×™×ª (××¢×•×’×œ ×œ×¢×©×™×¨×™×ª ×”×©× ×™×™×”)
                    const remainingSeconds = (remainingTime / 1000).toFixed(1);
                    feedbackElement.textContent = `××—×–×™×§ ×™×¦×™×‘... × ×•×ª×¨×• ${Math.max(0, remainingSeconds)} ×©× ×™×•×ª.`;
                    
                    // ×”×¦×œ×—×”!
                    if (heldDuration >= SUCCESS_HOLD_TIME_MS) {
                        clearInterval(checkInterval); // ×”×¤×¡×§ ×œ×‘×“×•×§
                        currentScene = 9; // ×”×¦×œ×—×” (New Scene 9)
                        feedbackElement.textContent = `âœ… ××¦××ª ××ª ×”×—×™×™×©×Ÿ ×”×ª×§×•×œ! ×”××‘× ××§×‘×œ ×¢×‘×•×“×”!`;
                        feedbackElement.classList.remove('text-yellow-400', 'text-red-500');
                        feedbackElement.classList.add('text-green-500');
                        updateScene();
                    }
                }
            } else {
                // ×œ× × ××¦× ××¢×œ ×”×¤×ª×¨×•×Ÿ
                if (holdStartTime !== null) {
                    // ×¨×§ ×× ×”×•× ×‘×“×™×•×§ ×™×¦× ××”××–×•×¨
                    feedbackElement.textContent = `××™×‘×“×ª ××ª ×”××™×§×•×“! × ×¡×” ×©×•×‘.`;
                    feedbackElement.classList.remove('text-green-500', 'text-yellow-400');
                    feedbackElement.classList.add('text-red-500');
                }
                holdStartTime = null;
            }
        }

        /** ××ª×—×•×œ ××©×—×§ ×”×—×§×™×¨×” ×”××™× ×˜×¨××§×˜×™×‘×™×ª ×©×œ ×”××‘× */
        function setupFatherGame() {
            magnifier = document.getElementById('magnifier');
            machineVisual = document.getElementById('machine-visual');
            const giveUpButton = document.getElementById('give-up-button');
            
            // ××™×¤×•×¡ ×–××Ÿ ×”×”×—×–×§×”
            holdStartTime = null; 
            
            // ××™×§×•× ×”×ª×—×œ×ª×™ ×©×œ ×”××’×“×œ×ª
            magnifier.style.left = '10px';
            magnifier.style.top = '10px';

            // ×× ×’× ×•×Ÿ ×”×‘×“×™×§×”: ×‘×•×“×§ ×›×œ 100ms ×× ×”××’×“×œ×ª × ××¦××ª ××¢×œ ×”×¨××–
            checkInterval = setInterval(checkForSolution, 100);

            // ×”×’×“×¨×ª ×××–×™× ×™ ×”××™×¨×•×¢×™× ×œ×’×¨×™×¨×” (×¢×›×‘×¨ ×•×˜××¦')
            machineVisual.onmousedown = startDrag;
            document.onmouseup = endDrag;
            document.onmousemove = drag;

            machineVisual.ontouchstart = startDrag;
            document.ontouchend = endDrag;
            document.ontouchmove = drag;

            // ×›×¤×ª×•×¨ ×•×™×ª×•×¨
            giveUpButton.onclick = () => {
                clearInterval(checkInterval);
                currentScene = 10; // ×›×™×©×œ×•×Ÿ (New Scene 10)
                document.getElementById('feedback-message').textContent = `ğŸ˜« ×”××‘× ×”×ª×™×™××© ××”×—×™×¤×•×© ×•×—×–×¨ ×”×‘×™×ª×” ×‘×™×“×™×™× ×¨×™×§×•×ª.`;
                document.getElementById('feedback-message').classList.remove('text-transparent', 'text-green-500', 'text-yellow-400');
                document.getElementById('feedback-message').classList.add('text-red-500', 'font-extrabold');
                updateScene();
            };
        }
        
        // --- ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ - ××©×—×§ 3 (×¡×¢×•×“×”) ---

        /** ××ª×—×•×œ ××©×—×§ ×¤×ª×™×—×ª ×”×‘×™×¦×™× */
        function setupFeastGame() {
            const container = document.getElementById('egg-opening-game');
            const feedbackElement = document.getElementById('feedback-message');
            
            container.classList.remove('hidden');
            container.innerHTML = '';
            
            eggsToOpen = 5;
            emptyEggFound = false;
            // ×‘×—×™×¨×ª ××™×§×•× ××§×¨××™ ×œ×‘×™×¦×” ×”×¨×™×§×”
            EMPTY_EGG_INDEX = Math.floor(Math.random() * 5); 
            
            feedbackElement.textContent = "×¤×ª×—×• ××ª 5 ×”×‘×™×¦×™× ×›×“×™ ×œ×—×©×•×£ ××ª ×”×ª×•×›×Ÿ ×©×œ×”×Ÿ!";
            feedbackElement.classList.remove('text-red-700');
            feedbackElement.classList.add('text-gray-700');


            for (let i = 0; i < 5; i++) {
                const eggDiv = document.createElement('div');
                // ×¡×’× ×•×Ÿ ×‘×¡×™×¡ ×œ×‘×™×¦×” ×¡×’×•×¨×”
                eggDiv.className = 'w-16 h-16 text-4xl bg-yellow-300 rounded-full flex items-center justify-center cursor-pointer transition-transform hover:scale-110 shadow-lg egg-item';
                eggDiv.innerHTML = 'ğŸ¥š';
                eggDiv.dataset.index = i;
                eggDiv.onclick = handleEggClick;
                container.appendChild(eggDiv);
            }
        }
        
        /** ×œ×•×’×™×§×” ×œ×œ×—×™×¦×” ×¢×œ ×‘×™×¦×” */
        function handleEggClick(event) {
            if (emptyEggFound) return;
            
            const eggDiv = event.target;
            const index = parseInt(eggDiv.dataset.index);

            // ×× ×›×‘×¨ × ×¤×ª×—, ×¦×
            if (eggDiv.classList.contains('bg-green-500') || eggDiv.classList.contains('bg-red-500')) {
                return; 
            }

            eggsToOpen--;
            eggDiv.onclick = null; // ××•× ×¢ ×§×œ×™×§×™× × ×•×¡×¤×™×

            const feedbackElement = document.getElementById('feedback-message');
            
            if (index === EMPTY_EGG_INDEX) {
                // ×”×‘×™×¦×” ×”×¨×™×§×” × ××¦××”! (×©×œ×‘ ×’×™×œ×•×™ ×”×‘×¢×™×”)
                emptyEggFound = true;
                eggDiv.innerHTML = 'ğŸ˜±';
                eggDiv.classList.remove('bg-yellow-300');
                eggDiv.classList.add('bg-red-500', 'text-white', 'bounce-animation');
                
                // ×”×•×“×¢×ª ×’×™×œ×•×™ ×”×‘×¢×™×” ×•×”×›× ×ª ××¢×‘×¨ ×œ×¡×¦× ×” ×”×‘××”
                feedbackElement.textContent = "×¨×’×¢! ×’× ×”×‘×™×¦×” ×”×–×• ×¨×™×§×”! '×–×” ×œ× ×¦×™×¨×•×£ ××§×¨×™×,' ×”××‘× ×××œ××œ. '×™×© ×¤×” ×‘×¢×™×” ×’×“×•×œ×”.'";
                feedbackElement.classList.remove('text-gray-700');
                feedbackElement.classList.add('text-red-700', 'font-extrabold');

                // ××¤×©×¨ ×”×ª×§×“××•×ª ×œ××©×—×§ ×”×—×§×™×¨×” ×©×œ ×”××‘×
                setTimeout(() => {
                    const buttonElement = document.getElementById('next-button');
                    buttonElement.classList.remove('hidden');
                    buttonElement.textContent = "×”××‘× ×™×•×¦× ×œ×—×§×•×¨ ××ª ×”×‘×¢×™×”"; 
                    buttonElement.onclick = () => { currentScene = 6; updateScene(); }; // ××¢×‘×¨ ×œ××©×—×§ ×”× ×™×ª×•×— ×™×•×× ×™× (New Scene 6)
                }, 1500);

            } else {
                // ×‘×™×¦×” ××œ××” ×‘×¤×¨×¡
                eggDiv.innerHTML = 'ğŸ';
                eggDiv.classList.remove('bg-yellow-300');
                eggDiv.classList.add('bg-green-500', 'text-white');
                feedbackElement.textContent = `×‘×™×¦×” ××œ××”! × ×•×ª×¨×• ${eggsToOpen} ×‘×™×¦×™× ×œ×¤×ª×™×—×”.`;
                feedbackElement.classList.remove('text-red-700');
                feedbackElement.classList.add('text-gray-700');
            }
        }
        
        // --- ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ - ××©×—×§ 6 (× ×™×ª×•×— ×™×•×× ×™×) - NEW ---
        
        /** ×™×¦×™×¨×ª × ×ª×•× ×™ ×™×•××Ÿ ××§×¨××™×™× ×¢× ×¢××•×“×” ×¤×’×•××” ××—×ª */
        function generateLogData() {
            logDataGrid = [];
            // ×‘×—×™×¨×ª ×¢××•×“×” ×¤×’×•××” ××§×¨××™×ª
            faultyColumn = Math.floor(Math.random() * LOG_GRID_SIZE);

            for (let r = 0; r < LOG_GRID_SIZE; r++) {
                logDataGrid[r] = [];
                for (let c = 0; c < LOG_GRID_SIZE; c++) {
                    let weight;
                    if (c === faultyColumn) {
                        // *× ×ª×•×Ÿ ×—×¨×™×’ (××©×§×œ × ××•×š ×‘××•×¤×Ÿ × ×™×›×¨ ××š ×œ× ××¤×¡)*: 50-100 ×’×¨×
                        weight = Math.floor(Math.random() * 51) + 50; 
                    } else {
                        // *× ×ª×•×Ÿ ×ª×§×™×Ÿ (×˜×•×•×— ×¨×—×‘ ×™×•×ª×¨)*: 150-250 ×’×¨×
                        weight = Math.floor(Math.random() * 101) + 150; 
                    }
                    logDataGrid[r][c] = weight;
                }
            }
        }
        
        /** ×˜×™×¤×•×œ ×‘×œ×—×™×¦×” ×¢×œ ×¢××•×“×ª × ×ª×•× ×™× */
        function handleLogClick(event) {
            if (currentScene !== 6) return;
            
            const clickedColumn = parseInt(event.target.dataset.column);
            const feedbackElement = document.getElementById('feedback-message');
            const logGrid = document.getElementById('log-grid');

            // ×”×¡×¨×ª ×”-onclick ××›×œ ×”×ª××™× ×œ××—×¨ ×”×œ×—×™×¦×” ×”×¨××©×•× ×”
            Array.from(logGrid.children).forEach(tile => {
                tile.onclick = null;
            });

            if (clickedColumn === faultyColumn) {
                // ×”×¦×œ×—×”
                feedbackElement.textContent = "âœ… ×”×¦×œ×—×”! ×–×™×”×™×ª× × ×›×•×Ÿ ××ª ×”× ×ª×•×Ÿ ×”×—×¨×™×’ ×©×œ ×—×™×™×©×Ÿ ×”××©×§×œ.";
                feedbackElement.classList.remove('text-gray-400', 'text-red-700');
                feedbackElement.classList.add('text-green-700', 'font-extrabold');
                
                // ×¡×™××•×Ÿ ×•×™×–×•××œ×™ ×©×œ ×”×¢××•×“×” ×”× ×›×•× ×”
                Array.from(logGrid.children).forEach(tile => {
                    if (parseInt(tile.dataset.column) === faultyColumn) {
                        tile.classList.remove('bg-gray-800', 'hover:bg-yellow-500');
                        tile.classList.add('bg-green-600', 'text-black', 'font-bold');
                    }
                });

                setTimeout(() => {
                    currentScene = 7; // ××¢×‘×¨ ×œ××©×—×§ ×”×ª×›× ×•×Ÿ
                    updateScene();
                }, 2000);
                
            } else {
                // ×›×™×©×œ×•×Ÿ
                feedbackElement.textContent = `âŒ ×˜×¢×•×ª! ×–×”×• ×—×™×™×©×Ÿ ×ª×§×™×Ÿ. ×¢×œ×™×š ×œ×—×–×•×¨ ×•×œ×ª×›× ×Ÿ ××ª ×”×—×§×™×¨×” ××”×”×ª×—×œ×”.`;
                feedbackElement.classList.remove('text-gray-400', 'text-green-700');
                feedbackElement.classList.add('text-red-700', 'font-extrabold');

                // ×¡×™××•×Ÿ ×•×™×–×•××œ×™ ×©×œ ×”×‘×—×™×¨×” ×”×©×’×•×™×” ×•×”× ×›×•× ×”
                Array.from(logGrid.children).forEach(tile => {
                    if (parseInt(tile.dataset.column) === clickedColumn) {
                        tile.classList.remove('bg-gray-800', 'hover:bg-yellow-500');
                        tile.classList.add('bg-red-600', 'text-white', 'font-bold');
                    } else if (parseInt(tile.dataset.column) === faultyColumn) {
                         tile.classList.remove('bg-gray-800', 'hover:bg-yellow-500');
                         tile.classList.add('bg-yellow-500', 'text-black', 'font-bold');
                    }
                });

                setTimeout(() => {
                    // ×›×™×©×œ×•×Ÿ ×× ×œ×™×˜×™ ××•×‘×™×œ ×œ×›×™×©×œ×•×Ÿ ×›×œ×œ×™
                    currentScene = 10; 
                    updateScene();
                }, 3000);
            }
        }

        /** ××ª×—×•×œ ××©×—×§ × ×™×ª×•×— ×”×™×•×× ×™× */
        function setupLogAnalysisGame() {
            const container = document.getElementById('log-analysis-game');
            const gridContainer = document.getElementById('log-grid');
            const feedbackElement = document.getElementById('feedback-message');
            
            container.classList.remove('hidden');
            gridContainer.innerHTML = '';
            
            // ×”×’×“×¨×ª ×’×•×“×œ ×”×¨×©×ª (5x5)
            gridContainer.style.gridTemplateColumns = `repeat(${LOG_GRID_SIZE}, minmax(0, 1fr))`;
            
            generateLogData(); // ×™×¦×™×¨×ª × ×ª×•× ×™× ×—×“×©×™×
            
            // ×™×¦×™×¨×ª ×”×›×•×ª×¨×•×ª (×©××•×ª ×”×—×™×™×©× ×™×)
            for (let c = 0; c < LOG_GRID_SIZE; c++) {
                const header = document.createElement('div');
                header.className = `p-1 text-xs font-bold text-center text-gray-400 border-b-2 border-gray-600`;
                header.textContent = `×—×™×™×©×Ÿ ${c + 1}`;
                gridContainer.appendChild(header);
            }
            
            // ×™×¦×™×¨×ª ×ª××™ ×”× ×ª×•× ×™×
            for (let r = 0; r < LOG_GRID_SIZE; r++) {
                for (let c = 0; c < LOG_GRID_SIZE; c++) {
                    const tile = document.createElement('div');
                    // ×¨×›×™×‘×™ ×”× ×ª×•× ×™×
                    tile.className = `p-3 text-lg font-mono text-white text-center rounded-md bg-gray-800 hover:bg-yellow-500 hover:shadow-lg cursor-pointer transition-all duration-150`;
                    tile.textContent = logDataGrid[r][c] + 'g'; // ×”×¦×’×ª ××©×§×œ ×‘×’×¨××™×
                    tile.dataset.column = c;
                    tile.dataset.row = r;
                    tile.onclick = handleLogClick;
                    gridContainer.appendChild(tile);
                }
            }
            
            feedbackElement.textContent = "× ×ª×— ××ª ×”× ×ª×•× ×™× ×•×‘×—×¨ ××ª ×”×¢××•×“×” ×”×¤×’×•××”.";
            feedbackElement.classList.remove('text-red-700', 'text-green-700');
            feedbackElement.classList.add('text-gray-400');
        }

        // --- ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ - ××©×—×§ 4 (×ª×›× ×•×Ÿ ×—×§×™×¨×”) ---

        /** ×œ×•×’×™×§×” ×œ×˜×™×¤×•×œ ×‘×‘×—×™×¨×ª ××–×•×¨ ×—×§×™×¨×” */
        function handlePlanningChoice(choice) {
            const feedbackElement = document.getElementById('feedback-message');
            const container = document.getElementById('planning-game');
            container.classList.add('hidden'); // ×”×¡×ª×¨×ª ×›×¤×ª×•×¨×™ ×”×‘×—×™×¨×”

            if (choice === 'weight') {
                // ×”×¦×œ×—×”: ×–×” ×”××–×•×¨ ×”× ×›×•×Ÿ, ×¢×‘×•×¨ ×œ××©×—×§ ×”×’×¨×™×¨×” (×¡×¦× ×” 8)
                feedbackElement.textContent = "×”×™×’×™×•×Ÿ ××¦×•×™×Ÿ! ×”×ª×—×œ×ª× ×‘×ª× ×‘×“×™×§×ª ×”××©×§×œ, ×”××–×•×¨ ×”×¨×’×™×© ×‘×™×•×ª×¨ ×œ×ª×§×œ×” ×–×•.";
                feedbackElement.classList.remove('text-red-700');
                feedbackElement.classList.add('text-green-700', 'font-extrabold');

                setTimeout(() => {
                    currentScene = 8; // ××¢×‘×¨ ×œ××©×—×§ ×”×’×¨×™×¨×” (New Scene 8)
                    updateScene();
                }, 1500);

            } else {
                // ×›×™×©×œ×•×Ÿ: ×‘×–×‘×•×– ×–××Ÿ, ×—×–×•×¨ ×œ×‘×—×™×¨×” (×¡×¦× ×” 7)
                let message = '';
                if (choice === 'vats') {
                    message = "×˜×¢×•×ª ×‘×©×™×§×•×œ! ××™×›×œ×™ ×”×¢×¨×‘×•×‘ ×”×™×• × ×§×™×™×. ×—×–×¨×• ×œ× ×§×•×“×ª ×”×”×ª×—×œ×” ×›×“×™ ×œ×‘×—×•×¨ ××–×•×¨ ××—×¨.";
                } else if (choice === 'insertion') {
                    message = "×˜×¢×•×ª ×‘×©×™×§×•×œ! ×–×¨×•×¢ ×”×–×¨×§×ª ×”×¦×¢×¦×•×¢ ×ª×§×™× ×”, ×”×‘×¢×™×” ×”×™× ×‘×©×•×§×•×œ×“ ×¢×¦××•. ×—×–×¨×• ×œ× ×§×•×“×ª ×”×”×ª×—×œ×”.";
                }

                feedbackElement.textContent = message;
                feedbackElement.classList.remove('text-green-700');
                feedbackElement.classList.add('text-red-700', 'font-extrabold');

                setTimeout(() => {
                    // × ×©××¨×™× ×‘×¡×¦× ×” 7, ×¨×§ ×× ×§×™× ××ª ×”-Feedback
                    feedbackElement.textContent = scenes[7].text;
                    feedbackElement.classList.remove('text-red-700', 'font-extrabold');
                    feedbackElement.classList.add('text-gray-700');
                    container.classList.remove('hidden'); // ×”×¦×’ ×©×•×‘ ××ª ×›×¤×ª×•×¨×™ ×”×‘×—×™×¨×”
                }, 2500);
            }
        }

        /** ××ª×—×•×œ ××©×—×§ ×ª×›× ×•×Ÿ ×”×—×§×™×¨×” */
        function setupPlanningGame() {
            const container = document.getElementById('planning-game');
            container.classList.remove('hidden');
            
            // ×”×’×“×¨×ª ×××–×™× ×™ ×”××™×¨×•×¢×™× ×œ×›×¤×ª×•×¨×™ ×”×‘×—×™×¨×”
            document.getElementById('plan-vats').onclick = () => handlePlanningChoice('vats');
            document.getElementById('plan-insertion').onclick = () => handlePlanningChoice('insertion');
            document.getElementById('plan-weight').onclick = () => handlePlanningChoice('weight');

        }

        /**
         * ×¤×•× ×§×¦×™×” ×œ×¢×“×›×•×Ÿ ×”×ª×¦×•×’×” ×‘×”×ª×× ×œ×¡×¦× ×” ×”× ×•×›×—×™×ª ×‘×¡×™×¤×•×¨.
         */
        function updateScene() {
            const card = document.getElementById('story-card');
            const textElement = document.getElementById('story-text');
            const buttonElement = document.getElementById('next-button');
            const iconElement = document.getElementById('icon');
            const feedbackElement = document.getElementById('feedback-message');
            const actionButtonsChild = document.getElementById('action-buttons-child');
            const gameStatusChild = document.getElementById('game-status-child');
            const investigationArea = document.getElementById('investigation-area');
            const eggOpeningGame = document.getElementById('egg-opening-game');
            const planningGame = document.getElementById('planning-game');
            const logAnalysisGame = document.getElementById('log-analysis-game'); // NEW
            
            const scene = scenes[currentScene];

            // --- × ×™×§×•×™ ××¦×‘×™× ×§×•×“××™× ×•××™×¤×•×¡ ×›×œ×œ×™ ---
            actionButtonsChild.classList.add('hidden');
            gameStatusChild.classList.add('hidden');
            investigationArea.classList.add('hidden');
            eggOpeningGame.classList.add('hidden');
            planningGame.classList.add('hidden'); 
            logAnalysisGame.classList.add('hidden'); // NEW
            buttonElement.classList.remove('hidden'); 
            feedbackElement.classList.remove('text-red-500', 'text-yellow-400', 'text-green-500', 'text-red-700', 'text-gray-700', 'font-extrabold');
            feedbackElement.classList.add('text-transparent');
            
            // ×¢×¦×™×¨×ª ×œ×•×œ××ª ×”×‘×“×™×§×” ×× ×™×•×¦××™× ××”××©×—×§
            if (checkInterval) {
                 clearInterval(checkInterval);
                 checkInterval = null;
            }

            // --- ×œ×•×’×™×§×ª ××©×—×§ ×¡×¤×¦×™×¤×™×ª ---

            // ××©×—×§ 1: ×©×›× ×•×¢ ×”×× ×”×œ (×™×œ×“)
            if (scene.isGameChild) {
                actionButtonsChild.classList.remove('hidden');
                gameStatusChild.classList.remove('hidden');
                feedbackElement.classList.remove('text-transparent');
                buttonElement.onclick = handleFinalPlea;
                updateStatusDisplay();
            } 
            // ××©×—×§ 3: ×¡×¢×•×“×ª ×”×¤×™×¦×•×™ (×¤×ª×™×—×ª ×‘×™×¦×™×)
            else if (scene.isGameFeast) {
                buttonElement.classList.add('hidden'); // ×›×¤×ª×•×¨ ×”-Next ××•×¤×™×¢ ×¨×§ ×›×©× ××¦××ª ×”×‘×™×¦×” ×”×¨×™×§×”
                feedbackElement.classList.remove('text-transparent');
                setupFeastGame();
            }
            // ××©×—×§ 6: × ×™×ª×•×— ×™×•×× ×™× (××‘×) - NEW
            else if (scene.isGameLogAnalysis) {
                 buttonElement.classList.add('hidden'); 
                 feedbackElement.classList.remove('text-transparent');
                 setupLogAnalysisGame();
            }
            // ××©×—×§ 4: ×ª×›× ×•×Ÿ ×”×—×§×™×¨×” (××‘× - ×‘×—×™×¨×”)
            else if (scene.isGamePlanning) {
                buttonElement.classList.add('hidden'); 
                feedbackElement.classList.remove('text-transparent');
                setupPlanningGame();
            }
            // ××©×—×§ 2: ×—×§×™×¨×ª ×”××¤×¢×œ (××‘× - ×’×¨×™×¨×”)
            else if (scene.isGameFather) {
                investigationArea.classList.remove('hidden');
                buttonElement.classList.add('hidden'); 
                feedbackElement.classList.add('text-transparent');
                
                setTimeout(setupFatherGame, 100); 
            } 
            // ×œ×•×’×™×§×” ××—×•×¥ ×œ××©×—×§ (×”×ª×§×“××•×ª ×œ×™× ×™××¨×™×ª ××• ××™×¤×•×¡)
            else {
                buttonElement.onclick = () => {
                    let nextSceneIndex = currentScene + 1;

                    // × ×™×•×•×˜ ××™×•×—×“
                    if (currentScene === 3) { // ××—×¨×™ ×¤×™×¦×•×™ ××œ× -> ×¡×¦× ×ª ×”×¡×¢×•×“×” (××©×—×§ 3)
                         nextSceneIndex = 5;
                    } else if (currentScene === 4) { // ××—×¨×™ ×¤×™×¦×•×™ ×—×œ×§×™ -> ×œ×•×œ××” ×—×–×¨×” ×œ××©×—×§ ×”×™×œ×“
                         nextSceneIndex = 2;
                    } else if (currentScene === 9 || currentScene === 10) { // × ×™×¦×—×•×Ÿ/×›×™×©×œ×•×Ÿ ×©×œ ×”××‘× (×”××™× ×“×§×¡×™× ×”×—×“×©×™×)
                        // ×¡×•×£ ×”×¡×™×¤×•×¨ -> ××™×¤×•×¡
                        nextSceneIndex = 0; 
                        attemptsLeft = 3; 
                        currentSuccessChance = 0.40; 
                        feedbackElement.textContent = '';
                    } 
                    
                    currentScene = nextSceneIndex;
                    updateScene();
                };
            }

            // --- ×¢×“×›×•×Ÿ ×¨×›×™×‘×™ UI ×›×œ×œ×™×™× ---
            textElement.innerHTML = scene.text;
            if (!scene.isGameChild && !scene.isGameFather && !scene.isGameFeast && !scene.isGamePlanning && !scene.isGameLogAnalysis) {
                 buttonElement.textContent = scene.button; 
            }

            // ×¢×“×›×•×Ÿ ×”××™×™×§×•×Ÿ + ×”×•×¡×¤×ª ×× ×™××¦×™×™×ª ×§×¤×™×¦×” ×§×œ×”
            iconElement.textContent = scene.icon;
            iconElement.classList.add('bounce-animation');
            setTimeout(() => {
                iconElement.classList.remove('bounce-animation');
            }, 500);

            // ×¢×“×›×•×Ÿ ×¦×‘×¢ ×”×¨×§×¢ ×©×œ ×”×›×¨×˜×™×¡
            card.className = `p-8 rounded-xl shadow-2xl transition-all duration-500 text-center mx-4 md:mx-auto max-w-lg w-full ${scene.color}`;
        }

        // --- ××ª×—×•×œ ---
        window.onload = () => {
            // ×”×’×“×¨×ª ×××–×™× ×™× ×œ×›×¤×ª×•×¨×™ ×”×¤×¢×•×œ×” ×©×œ ×”×™×œ×“ ×¤×¢× ××—×ª
            document.getElementById('cry-button').onclick = handleCry;
            document.getElementById('logic-button').onclick = handleLogic;
            
            // ××ª×—×•×œ ×”×¡×™×¤×•×¨
            updateScene();
        };
    </script>

</body>
</html>
